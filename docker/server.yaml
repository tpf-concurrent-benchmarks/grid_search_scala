version: "3.7"

services:
  worker:
    image: efoppiano/grid_search_scala_worker:v0.1
    depends_on:
      - rabbitmq
      - graphite
    deploy:
      replicas: ${WORKER_REPLICAS}
      restart_policy:
        condition: none
    environment:
      - LOCAL=${LOCAL}
      - NODE_ID=worker_{{.Task.Slot}}

  manager:
    image: efoppiano/grid_search_scala_manager:v0.1
    depends_on:
      - rabbitmq
      - graphite
    deploy:
      restart_policy:
        condition: none
    environment:
      - LOCAL=${LOCAL}
      - NODE_ID=manager